name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    name: PowerShell Lint
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run PSScriptAnalyzer
        shell: pwsh
        run: |
          Install-Module -Name PSScriptAnalyzer -Force -Scope CurrentUser
          $results = Invoke-ScriptAnalyzer -Path .\convert-to-pdf.ps1 -Severity Warning,Error
          if ($results) {
            $results | Format-Table -AutoSize
            exit 1
          }
          Write-Host "âœ“ No issues found" -ForegroundColor Green

  test:
    name: Test Conversion
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install Pandoc
        shell: pwsh
        run: |
          choco install pandoc -y
          refreshenv
      
      - name: Install MiKTeX
        shell: pwsh
        run: |
          choco install miktex -y
          refreshenv
      
      - name: Verify Tools
        shell: pwsh
        run: |
          Write-Host "Pandoc:" (pandoc --version | Select-Object -First 1)
          Write-Host "PowerShell:" $PSVersionTable.PSVersion
      
      - name: Test Basic Conversion
        shell: pwsh
        run: |
          # Note: Full PDF generation requires LaTeX packages
          # This validates script syntax and basic execution
          $ErrorActionPreference = 'Stop'
          . .\convert-to-pdf.ps1 -File sample.md -WhatIf 2>$null || Write-Host "Script loaded successfully"
